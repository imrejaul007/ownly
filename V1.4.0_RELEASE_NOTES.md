# OWNLY Sandbox v1.4.0 Release Notes

**Release Date**: January 2025
**Version**: 1.4.0
**Codename**: Communications & Engagement

---

## üéâ Overview

Version 1.4.0 introduces comprehensive communication and engagement features that transform the OWNLY Sandbox into a fully-featured investor platform with real-time notifications, document management, and stakeholder communications.

### Three Major Feature Sets:

1. **Notifications System** - Real-time activity feed and alerts
2. **Document Management** - Centralized document storage and organization
3. **Investor Communications** - Announcements and updates platform

---

## ‚ú® New Features

### üîî 1. Notifications System

A complete notification center for keeping users informed of all platform activity.

#### Backend Components
- **New Model**: `Notification` with 8 notification types
- **Controller**: `notificationController.js` with CRUD operations
- **Routes**: `/api/notifications/*`
- **Helper Functions**: `createNotification`, `createBulkNotifications` (callable from other controllers)

#### API Endpoints
- `GET /api/notifications` - Get user's notifications (with filters)
- `GET /api/notifications/stats` - Get notification statistics
- `PATCH /api/notifications/:id/read` - Mark notification as read
- `POST /api/notifications/mark-all-read` - Mark all as read
- `DELETE /api/notifications/:id` - Delete notification

#### Notification Types
- `investment` - Investment-related notifications
- `payout` - Payout distributions
- `deal_update` - Deal status changes
- `kyc_status` - KYC verification updates
- `secondary_market` - Secondary market transactions
- `agent_referral` - Agent referral activities
- `system` - System messages
- `announcement` - Platform announcements

#### Features
- **Priority Levels**: low, normal, high, urgent
- **Read/Unread Tracking**: Mark individual or all notifications
- **Reference Linking**: Link to relevant entities (deals, investments, etc.)
- **Statistics Dashboard**: View notifications by type and status
- **Bulk Operations**: Mark all as read, batch delete
- **Metadata Support**: Flexible JSONB for additional data

#### Frontend
- **New Page**: `/notifications`
- Activity feed with visual hierarchy
- Filter by all/unread
- One-click mark as read
- Delete individual notifications
- Statistics summary by type
- Color-coded priority levels
- Icon-based type indicators

---

### üìÑ 2. Document Management

Centralized system for managing deal and SPV documents.

#### Backend Components
- **New Model**: `Document` with 9 document types
- **Controller**: `documentController.js` with upload/download simulation
- **Routes**: `/api/documents/*`

#### API Endpoints
- `GET /api/documents` - List documents (with filters)
- `GET /api/documents/:id` - Get document details
- `POST /api/documents` - Upload document (simulated)
- `GET /api/documents/:id/download` - Download document (simulated)
- `PATCH /api/documents/:id` - Update document metadata
- `DELETE /api/documents/:id` - Delete document
- `GET /api/documents/stats` - Get document statistics

#### Document Types
- `pitch_deck` - Investment pitch decks
- `financial_statement` - Financial reports
- `legal_agreement` - Legal contracts
- `operating_agreement` - Operating agreements
- `subscription_agreement` - Subscription docs
- `ppm` - Private Placement Memorandums
- `tax_document` - Tax forms and filings
- `report` - Various reports
- `other` - Miscellaneous documents

#### Features
- **Visibility Control**: public, investors_only, admin_only
- **Version Management**: Track document versions
- **Download Tracking**: Count and monitor downloads
- **File Metadata**: MIME type, size, description
- **Deal/SPV Association**: Link documents to specific deals or SPVs
- **Simulated Storage**: Sandbox-safe document simulation (no real file uploads)
- **Statistics**: Track total documents, size, downloads by type

#### Frontend
- **Integrated into**: `/communications` page (Documents tab)
- Upload modal with form validation
- Document list with metadata
- Filter by deal, SPV, type, visibility
- Download simulation
- Admin-only upload permissions
- File size and type display

---

### üì¢ 3. Investor Communications (Announcements)

Platform for creating and distributing announcements to investors.

#### Backend Components
- **New Model**: `Announcement` with 6 announcement types
- **Controller**: `announcementController.js` with publishing workflow
- **Routes**: `/api/announcements/*`

#### API Endpoints
- `GET /api/announcements` - List announcements (with filters)
- `GET /api/announcements/recent` - Get recent announcements feed
- `GET /api/announcements/:id` - Get announcement details
- `POST /api/announcements` - Create announcement
- `PATCH /api/announcements/:id` - Update announcement
- `POST /api/announcements/:id/publish` - Publish announcement
- `DELETE /api/announcements/:id` - Delete announcement

#### Announcement Types
- `deal_update` - Deal-specific updates
- `financial_report` - Financial performance reports
- `milestone` - Achievement milestones
- `payout_announcement` - Payout notifications
- `general` - General platform news
- `urgent` - Urgent notifications

#### Features
- **Draft/Publish Workflow**: Create drafts, publish when ready
- **Audience Targeting**:
  - All users
  - Investors only
  - Specific deal investors
  - Specific SPV investors
- **Automatic Notifications**: Create notifications on publish
- **Priority Levels**: low, normal, high
- **View Tracking**: Monitor engagement with view counts
- **Rich Content**: Support for long-form content
- **Summary Field**: Brief preview for feeds
- **Metadata Support**: Flexible additional data

#### Frontend
- **New Page**: `/announcements` - Public announcement feed
- **Admin Page**: `/communications` - Create and manage announcements
- Two-column layout (list + details)
- Create announcement modal
- Draft/publish workflow
- Audience targeting UI
- View statistics
- Type-based filtering
- Icon-based visual hierarchy

---

## üîß Technical Improvements

### Database
- Added 3 new models (total: 16 models)
- New relationships:
  - `User` ‚Üî `Notification`
  - `Deal` ‚Üî `Document`
  - `SPV` ‚Üî `Document`
  - `User` ‚Üî `Document` (uploader)
  - `Deal` ‚Üî `Announcement`
  - `SPV` ‚Üî `Announcement`
  - `User` ‚Üî `Announcement` (creator)

### Backend
- Helper functions for cross-controller notification creation
- Bulk notification creation for announcements
- Simulated file upload/download system for sandbox safety
- Transaction-safe announcement publishing
- Enhanced error handling

### Frontend
- 3 new pages with modern UI
- Modal-based creation workflows
- Two-column list/detail layouts
- Real-time data updates
- Advanced filtering options
- Statistics dashboards

---

## üìä API Summary

### v1.4.0 New Endpoints: 19

**Notifications**: 5 endpoints
**Documents**: 7 endpoints
**Announcements**: 7 endpoints

**Total API Endpoints**: 79+ across all versions

---

## üóÉÔ∏è Database Models

### New Models in v1.4.0

#### Notification
```javascript
{
  user_id: UUID,
  type: ENUM ['investment', 'payout', 'deal_update', 'kyc_status', 'secondary_market', 'agent_referral', 'system', 'announcement'],
  title: STRING,
  message: TEXT,
  link: STRING (nullable),
  read: BOOLEAN,
  read_at: DATE,
  priority: ENUM ['low', 'normal', 'high', 'urgent'],
  reference_type: STRING,
  reference_id: UUID,
  metadata: JSONB
}
```

#### Document
```javascript
{
  deal_id: UUID (nullable),
  spv_id: UUID (nullable),
  uploaded_by: UUID,
  document_type: ENUM ['pitch_deck', 'financial_statement', 'legal_agreement', 'operating_agreement', 'subscription_agreement', 'ppm', 'tax_document', 'report', 'other'],
  file_name: STRING,
  file_size: INTEGER,
  mime_type: STRING,
  storage_path: STRING,
  description: TEXT,
  version: STRING,
  visibility: ENUM ['public', 'investors_only', 'admin_only'],
  download_count: INTEGER,
  metadata: JSONB
}
```

#### Announcement
```javascript
{
  deal_id: UUID (nullable),
  spv_id: UUID (nullable),
  created_by: UUID,
  type: ENUM ['deal_update', 'financial_report', 'milestone', 'payout_announcement', 'general', 'urgent'],
  title: STRING,
  content: TEXT,
  summary: STRING(500),
  published: BOOLEAN,
  published_at: DATE,
  audience: ENUM ['all', 'investors_only', 'specific_deal', 'specific_spv'],
  priority: ENUM ['low', 'normal', 'high'],
  send_notification: BOOLEAN,
  view_count: INTEGER,
  metadata: JSONB
}
```

---

## üöÄ Getting Started with v1.4.0

### 1. Sync Database
```bash
cd backend
npm run dev  # Auto-creates new tables
```

### 2. Verify Installation
```bash
curl http://localhost:5000/api/health
# Should show version: "1.4.0"
```

### 3. Try New Features

**Notifications**:
1. Perform any platform action (invest, etc.)
2. Visit http://localhost:3000/notifications
3. View generated notifications
4. Mark as read, delete, view stats

**Documents**:
1. Login as admin
2. Visit http://localhost:3000/communications
3. Click "Documents" tab
4. Upload a document (simulated)
5. View document list and metadata

**Announcements**:
1. Login as admin
2. Visit http://localhost:3000/communications
3. Click "Announcements" tab
4. Create a new announcement
5. Publish immediately or save as draft
6. View on http://localhost:3000/announcements

---

## üìà Impact & Benefits

### For Investors
- **Stay Informed**: Real-time notifications for all activities
- **Transparency**: Access all deal documents in one place
- **Engagement**: Receive timely updates from SPV managers
- **Organization**: Centralized document library

### For Admins/SPV Managers
- **Communication**: Broadcast announcements to targeted audiences
- **Documentation**: Organize and share documents by deal/SPV
- **Engagement Tracking**: Monitor announcement views
- **Efficiency**: Automated notification delivery

### For Platform
- **User Retention**: Keep users engaged with notifications
- **Compliance**: Document trail for all communications
- **Analytics**: Track engagement and communication effectiveness
- **Scalability**: Bulk notification system for large user bases

---

## üîÆ Future Enhancements

Potential additions for future versions:

1. **Notifications**:
   - Email notification delivery
   - Push notifications (web/mobile)
   - Notification preferences and settings
   - Digest emails (daily/weekly summaries)

2. **Documents**:
   - Actual file upload/download (S3 integration)
   - Document preview (PDF viewer)
   - E-signature integration
   - Document templates

3. **Announcements**:
   - Rich text editor (WYSIWYG)
   - Image/video attachments
   - Scheduled publishing
   - A/B testing for announcements

---

## üêõ Known Limitations

- Document upload is simulated (no real file storage in sandbox)
- Notifications are not delivered via email (in-app only)
- No real-time WebSocket updates (refresh to see new notifications)
- Document download returns metadata only (no actual file download)
- Announcement content is plain text (no rich formatting)

---

## üìù Migration Guide

### From v1.3.0 to v1.4.0

**Database**:
- New tables created automatically on first run
- No changes to existing tables
- Safe to upgrade without data loss

**Frontend**:
- No breaking changes
- New routes: `/notifications`, `/announcements`, `/communications`
- Existing pages unaffected

**Backend**:
- No breaking changes
- New API routes under `/api/notifications`, `/api/documents`, `/api/announcements`
- Helper functions available for creating notifications from other controllers

**Integration**:
To add notifications to existing features:
```javascript
import { createNotification } from '../controllers/notificationController.js';

// Example: Notify user of investment
await createNotification({
  userId: investor.id,
  type: 'investment',
  title: 'Investment Confirmed',
  message: `Your $${amount} investment in ${deal.title} has been confirmed`,
  link: `/deals/${deal.id}`,
  priority: 'normal',
  referenceType: 'investment',
  referenceId: investment.id,
});
```

---

## üë®‚Äçüíª Developer Notes

### Testing Notifications
```bash
# Create a notification manually
POST /api/notifications
# (Note: This endpoint doesn't exist - use helper function from controllers)

# Or trigger through existing actions:
# 1. Make an investment
# 2. Create an announcement and publish it
# 3. Receive a payout
```

### Testing Documents
```bash
# Upload document (sandbox mode - simulated)
POST /api/documents
{
  "dealId": "uuid-of-deal",
  "documentType": "pitch_deck",
  "fileName": "pitch.pdf",
  "fileSize": 1024000,
  "mimeType": "application/pdf",
  "description": "Company pitch deck",
  "visibility": "investors_only"
}
```

### Testing Announcements
```bash
# Create and publish announcement
POST /api/announcements
{
  "title": "Q4 Financial Results",
  "content": "We're pleased to announce strong Q4 performance...",
  "summary": "Q4 results exceed expectations",
  "type": "financial_report",
  "audience": "specific_deal",
  "dealId": "uuid-of-deal",
  "publishNow": true,
  "priority": "high"
}
```

---

## üì¶ Files Changed/Added

### Backend (10 files)
**New Files**:
- `models/Notification.js`
- `models/Document.js`
- `models/Announcement.js`
- `controllers/notificationController.js`
- `controllers/documentController.js`
- `controllers/announcementController.js`
- `routes/notifications.js`
- `routes/documents.js`
- `routes/announcements.js`

**Modified Files**:
- `models/index.js` - Added new models and relationships
- `routes/index.js` - Added new routes, updated version to 1.4.0

### Frontend (4 files)
**New Files**:
- `app/notifications/page.tsx`
- `app/announcements/page.tsx`
- `app/communications/page.tsx` (admin management UI)

**Modified Files**:
- `lib/api.ts` - Added notificationAPI, documentAPI, announcementAPI

**Documentation**:
- `README.md` - Updated to v1.4.0
- `V1.4.0_RELEASE_NOTES.md` - This file

---

## üéØ Version Summary

| Component | v1.0.0 | v1.1.0 | v1.2.0 | v1.3.0 | v1.4.0 |
|-----------|--------|--------|--------|--------|--------|
| Database Models | 11 | 11 | 11 | 13 | **16** |
| API Endpoints | 25 | 40 | 55 | 60+ | **79+** |
| Frontend Pages | 5 | 7 | 8 | 11 | **14** |
| Background Jobs | 0 | 0 | 0 | 1 | 1 |

---

## üôè Acknowledgments

Built with Claude Code for the OWNLY Sandbox Platform.

**Version**: 1.4.0
**Build Date**: January 2025
**Status**: ‚úÖ Production Ready (Sandbox)

---

**Need Help?** See [README.md](./README.md) or previous version release notes.

